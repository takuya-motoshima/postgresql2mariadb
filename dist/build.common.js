"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("fs"),t=require("path"),i=require("os"),n=require("readline"),r=require("node:events"),s=require("node:child_process"),o=require("node:path"),a=require("node:fs"),l=require("node:process");function c(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var h=c(e),u=c(t),p=c(i),m=c(n),d=c(r),g=c(s),f=c(o),_=c(a),v=c(l),b={},O={},A={};class w extends Error{constructor(e,t,i){super(i),Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.code=t,this.exitCode=e,this.nestedError=void 0}}A.CommanderError=w,A.InvalidArgumentError=class extends w{constructor(e){super(1,"commander.invalidArgument",e),Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name}};const{InvalidArgumentError:y}=A;O.Argument=class{constructor(e,t){switch(this.description=t||"",this.variadic=!1,this.parseArg=void 0,this.defaultValue=void 0,this.defaultValueDescription=void 0,this.argChoices=void 0,e[0]){case"<":this.required=!0,this._name=e.slice(1,-1);break;case"[":this.required=!1,this._name=e.slice(1,-1);break;default:this.required=!0,this._name=e}this._name.length>3&&"..."===this._name.slice(-3)&&(this.variadic=!0,this._name=this._name.slice(0,-3))}name(){return this._name}_concatValue(e,t){return t!==this.defaultValue&&Array.isArray(t)?t.concat(e):[e]}default(e,t){return this.defaultValue=e,this.defaultValueDescription=t,this}argParser(e){return this.parseArg=e,this}choices(e){return this.argChoices=e.slice(),this.parseArg=(e,t)=>{if(!this.argChoices.includes(e))throw new y(`Allowed choices are ${this.argChoices.join(", ")}.`);return this.variadic?this._concatValue(e,t):e},this}argRequired(){return this.required=!0,this}argOptional(){return this.required=!1,this}},O.humanReadableArgName=function(e){const t=e.name()+(!0===e.variadic?"...":"");return e.required?"<"+t+">":"["+t+"]"};var x={},C={};const{humanReadableArgName:E}=O;C.Help=class{constructor(){this.helpWidth=void 0,this.sortSubcommands=!1,this.sortOptions=!1,this.showGlobalOptions=!1}visibleCommands(e){const t=e.commands.filter((e=>!e._hidden)),i=e._getHelpCommand();return i&&!i._hidden&&t.push(i),this.sortSubcommands&&t.sort(((e,t)=>e.name().localeCompare(t.name()))),t}compareOptions(e,t){const i=e=>e.short?e.short.replace(/^-/,""):e.long.replace(/^--/,"");return i(e).localeCompare(i(t))}visibleOptions(e){const t=e.options.filter((e=>!e.hidden)),i=e._getHelpOption();if(i&&!i.hidden){const n=i.short&&e._findOption(i.short),r=i.long&&e._findOption(i.long);n||r?i.long&&!r?t.push(e.createOption(i.long,i.description)):i.short&&!n&&t.push(e.createOption(i.short,i.description)):t.push(i)}return this.sortOptions&&t.sort(this.compareOptions),t}visibleGlobalOptions(e){if(!this.showGlobalOptions)return[];const t=[];for(let i=e.parent;i;i=i.parent){const e=i.options.filter((e=>!e.hidden));t.push(...e)}return this.sortOptions&&t.sort(this.compareOptions),t}visibleArguments(e){return e._argsDescription&&e.registeredArguments.forEach((t=>{t.description=t.description||e._argsDescription[t.name()]||""})),e.registeredArguments.find((e=>e.description))?e.registeredArguments:[]}subcommandTerm(e){const t=e.registeredArguments.map((e=>E(e))).join(" ");return e._name+(e._aliases[0]?"|"+e._aliases[0]:"")+(e.options.length?" [options]":"")+(t?" "+t:"")}optionTerm(e){return e.flags}argumentTerm(e){return e.name()}longestSubcommandTermLength(e,t){return t.visibleCommands(e).reduce(((e,i)=>Math.max(e,t.subcommandTerm(i).length)),0)}longestOptionTermLength(e,t){return t.visibleOptions(e).reduce(((e,i)=>Math.max(e,t.optionTerm(i).length)),0)}longestGlobalOptionTermLength(e,t){return t.visibleGlobalOptions(e).reduce(((e,i)=>Math.max(e,t.optionTerm(i).length)),0)}longestArgumentTermLength(e,t){return t.visibleArguments(e).reduce(((e,i)=>Math.max(e,t.argumentTerm(i).length)),0)}commandUsage(e){let t=e._name;e._aliases[0]&&(t=t+"|"+e._aliases[0]);let i="";for(let t=e.parent;t;t=t.parent)i=t.name()+" "+i;return i+t+" "+e.usage()}commandDescription(e){return e.description()}subcommandDescription(e){return e.summary()||e.description()}optionDescription(e){const t=[];if(e.argChoices&&t.push(`choices: ${e.argChoices.map((e=>JSON.stringify(e))).join(", ")}`),void 0!==e.defaultValue){(e.required||e.optional||e.isBoolean()&&"boolean"==typeof e.defaultValue)&&t.push(`default: ${e.defaultValueDescription||JSON.stringify(e.defaultValue)}`)}return void 0!==e.presetArg&&e.optional&&t.push(`preset: ${JSON.stringify(e.presetArg)}`),void 0!==e.envVar&&t.push(`env: ${e.envVar}`),t.length>0?`${e.description} (${t.join(", ")})`:e.description}argumentDescription(e){const t=[];if(e.argChoices&&t.push(`choices: ${e.argChoices.map((e=>JSON.stringify(e))).join(", ")}`),void 0!==e.defaultValue&&t.push(`default: ${e.defaultValueDescription||JSON.stringify(e.defaultValue)}`),t.length>0){const i=`(${t.join(", ")})`;return e.description?`${e.description} ${i}`:i}return e.description}formatHelp(e,t){const i=t.padWidth(e,t),n=t.helpWidth||80;function r(e,r){if(r){const s=`${e.padEnd(i+2)}${r}`;return t.wrap(s,n-2,i+2)}return e}function s(e){return e.join("\n").replace(/^/gm," ".repeat(2))}let o=[`Usage: ${t.commandUsage(e)}`,""];const a=t.commandDescription(e);a.length>0&&(o=o.concat([t.wrap(a,n,0),""]));const l=t.visibleArguments(e).map((e=>r(t.argumentTerm(e),t.argumentDescription(e))));l.length>0&&(o=o.concat(["Arguments:",s(l),""]));const c=t.visibleOptions(e).map((e=>r(t.optionTerm(e),t.optionDescription(e))));if(c.length>0&&(o=o.concat(["Options:",s(c),""])),this.showGlobalOptions){const i=t.visibleGlobalOptions(e).map((e=>r(t.optionTerm(e),t.optionDescription(e))));i.length>0&&(o=o.concat(["Global Options:",s(i),""]))}const h=t.visibleCommands(e).map((e=>r(t.subcommandTerm(e),t.subcommandDescription(e))));return h.length>0&&(o=o.concat(["Commands:",s(h),""])),o.join("\n")}padWidth(e,t){return Math.max(t.longestOptionTermLength(e,t),t.longestGlobalOptionTermLength(e,t),t.longestSubcommandTermLength(e,t),t.longestArgumentTermLength(e,t))}wrap(e,t,i,n=40){const r=new RegExp("[\\n][ \\f\\t\\v   -   　\ufeff]+");if(e.match(r))return e;const s=t-i;if(s<n)return e;const o=e.slice(0,i),a=e.slice(i).replace("\r\n","\n"),l=" ".repeat(i),c="\\s​",h=new RegExp(`\n|.{1,${s-1}}([${c}]|$)|[^${c}]+?([${c}]|$)`,"g");return o+(a.match(h)||[]).map(((e,t)=>"\n"===e?"":(t>0?l:"")+e.trimEnd())).join("\n")}};var $={};const{InvalidArgumentError:k}=A;$.Option=class{constructor(e,t){this.flags=e,this.description=t||"",this.required=e.includes("<"),this.optional=e.includes("["),this.variadic=/\w\.\.\.[>\]]$/.test(e),this.mandatory=!1;const i=function(e){let t,i;const n=e.split(/[ |,]+/);n.length>1&&!/^[[<]/.test(n[1])&&(t=n.shift());i=n.shift(),!t&&/^-[^-]$/.test(i)&&(t=i,i=void 0);return{shortFlag:t,longFlag:i}}(e);this.short=i.shortFlag,this.long=i.longFlag,this.negate=!1,this.long&&(this.negate=this.long.startsWith("--no-")),this.defaultValue=void 0,this.defaultValueDescription=void 0,this.presetArg=void 0,this.envVar=void 0,this.parseArg=void 0,this.hidden=!1,this.argChoices=void 0,this.conflictsWith=[],this.implied=void 0}default(e,t){return this.defaultValue=e,this.defaultValueDescription=t,this}preset(e){return this.presetArg=e,this}conflicts(e){return this.conflictsWith=this.conflictsWith.concat(e),this}implies(e){let t=e;return"string"==typeof e&&(t={[e]:!0}),this.implied=Object.assign(this.implied||{},t),this}env(e){return this.envVar=e,this}argParser(e){return this.parseArg=e,this}makeOptionMandatory(e=!0){return this.mandatory=!!e,this}hideHelp(e=!0){return this.hidden=!!e,this}_concatValue(e,t){return t!==this.defaultValue&&Array.isArray(t)?t.concat(e):[e]}choices(e){return this.argChoices=e.slice(),this.parseArg=(e,t)=>{if(!this.argChoices.includes(e))throw new k(`Allowed choices are ${this.argChoices.join(", ")}.`);return this.variadic?this._concatValue(e,t):e},this}name(){return this.long?this.long.replace(/^--/,""):this.short.replace(/^-/,"")}attributeName(){return this.name().replace(/^no-/,"").split("-").reduce(((e,t)=>e+t[0].toUpperCase()+t.slice(1)))}is(e){return this.short===e||this.long===e}isBoolean(){return!this.required&&!this.optional&&!this.negate}},$.DualOptions=class{constructor(e){this.positiveOptions=new Map,this.negativeOptions=new Map,this.dualOptions=new Set,e.forEach((e=>{e.negate?this.negativeOptions.set(e.attributeName(),e):this.positiveOptions.set(e.attributeName(),e)})),this.negativeOptions.forEach(((e,t)=>{this.positiveOptions.has(t)&&this.dualOptions.add(t)}))}valueFromOption(e,t){const i=t.attributeName();if(!this.dualOptions.has(i))return!0;const n=this.negativeOptions.get(i).presetArg,r=void 0!==n&&n;return t.negate===(r===e)}};var H={};const S=3;H.suggestSimilar=function(e,t){if(!t||0===t.length)return"";t=Array.from(new Set(t));const i=e.startsWith("--");i&&(e=e.slice(2),t=t.map((e=>e.slice(2))));let n=[],r=S;return t.forEach((t=>{if(t.length<=1)return;const i=function(e,t){if(Math.abs(e.length-t.length)>S)return Math.max(e.length,t.length);const i=[];for(let t=0;t<=e.length;t++)i[t]=[t];for(let e=0;e<=t.length;e++)i[0][e]=e;for(let n=1;n<=t.length;n++)for(let r=1;r<=e.length;r++){let s=1;s=e[r-1]===t[n-1]?0:1,i[r][n]=Math.min(i[r-1][n]+1,i[r][n-1]+1,i[r-1][n-1]+s),r>1&&n>1&&e[r-1]===t[n-2]&&e[r-2]===t[n-1]&&(i[r][n]=Math.min(i[r][n],i[r-2][n-2]+1))}return i[e.length][t.length]}(e,t),s=Math.max(e.length,t.length);(s-i)/s>.4&&(i<r?(r=i,n=[t]):i===r&&n.push(t))})),n.sort(((e,t)=>e.localeCompare(t))),i&&(n=n.map((e=>`--${e}`))),n.length>1?`\n(Did you mean one of ${n.join(", ")}?)`:1===n.length?`\n(Did you mean ${n[0]}?)`:""};const V=d.default.EventEmitter,T=g.default,j=f.default,q=_.default,P=v.default,{Argument:N,humanReadableArgName:D}=O,{CommanderError:R}=A,{Help:F}=C,{Option:I,DualOptions:L}=$,{suggestSimilar:z}=H;class M extends V{constructor(e){super(),this.commands=[],this.options=[],this.parent=null,this._allowUnknownOption=!1,this._allowExcessArguments=!0,this.registeredArguments=[],this._args=this.registeredArguments,this.args=[],this.rawArgs=[],this.processedArgs=[],this._scriptPath=null,this._name=e||"",this._optionValues={},this._optionValueSources={},this._storeOptionsAsProperties=!1,this._actionHandler=null,this._executableHandler=!1,this._executableFile=null,this._executableDir=null,this._defaultCommandName=null,this._exitCallback=null,this._aliases=[],this._combineFlagAndOptionalValue=!0,this._description="",this._summary="",this._argsDescription=void 0,this._enablePositionalOptions=!1,this._passThroughOptions=!1,this._lifeCycleHooks={},this._showHelpAfterError=!1,this._showSuggestionAfterError=!0,this._outputConfiguration={writeOut:e=>P.stdout.write(e),writeErr:e=>P.stderr.write(e),getOutHelpWidth:()=>P.stdout.isTTY?P.stdout.columns:void 0,getErrHelpWidth:()=>P.stderr.isTTY?P.stderr.columns:void 0,outputError:(e,t)=>t(e)},this._hidden=!1,this._helpOption=void 0,this._addImplicitHelpCommand=void 0,this._helpCommand=void 0,this._helpConfiguration={}}copyInheritedSettings(e){return this._outputConfiguration=e._outputConfiguration,this._helpOption=e._helpOption,this._helpCommand=e._helpCommand,this._helpConfiguration=e._helpConfiguration,this._exitCallback=e._exitCallback,this._storeOptionsAsProperties=e._storeOptionsAsProperties,this._combineFlagAndOptionalValue=e._combineFlagAndOptionalValue,this._allowExcessArguments=e._allowExcessArguments,this._enablePositionalOptions=e._enablePositionalOptions,this._showHelpAfterError=e._showHelpAfterError,this._showSuggestionAfterError=e._showSuggestionAfterError,this}_getCommandAndAncestors(){const e=[];for(let t=this;t;t=t.parent)e.push(t);return e}command(e,t,i){let n=t,r=i;"object"==typeof n&&null!==n&&(r=n,n=null),r=r||{};const[,s,o]=e.match(/([^ ]+) *(.*)/),a=this.createCommand(s);return n&&(a.description(n),a._executableHandler=!0),r.isDefault&&(this._defaultCommandName=a._name),a._hidden=!(!r.noHelp&&!r.hidden),a._executableFile=r.executableFile||null,o&&a.arguments(o),this._registerCommand(a),a.parent=this,a.copyInheritedSettings(this),n?this:a}createCommand(e){return new M(e)}createHelp(){return Object.assign(new F,this.configureHelp())}configureHelp(e){return void 0===e?this._helpConfiguration:(this._helpConfiguration=e,this)}configureOutput(e){return void 0===e?this._outputConfiguration:(Object.assign(this._outputConfiguration,e),this)}showHelpAfterError(e=!0){return"string"!=typeof e&&(e=!!e),this._showHelpAfterError=e,this}showSuggestionAfterError(e=!0){return this._showSuggestionAfterError=!!e,this}addCommand(e,t){if(!e._name)throw new Error("Command passed to .addCommand() must have a name\n- specify the name in Command constructor or using .name()");return(t=t||{}).isDefault&&(this._defaultCommandName=e._name),(t.noHelp||t.hidden)&&(e._hidden=!0),this._registerCommand(e),e.parent=this,e._checkForBrokenPassThrough(),this}createArgument(e,t){return new N(e,t)}argument(e,t,i,n){const r=this.createArgument(e,t);return"function"==typeof i?r.default(n).argParser(i):r.default(i),this.addArgument(r),this}arguments(e){return e.trim().split(/ +/).forEach((e=>{this.argument(e)})),this}addArgument(e){const t=this.registeredArguments.slice(-1)[0];if(t&&t.variadic)throw new Error(`only the last argument can be variadic '${t.name()}'`);if(e.required&&void 0!==e.defaultValue&&void 0===e.parseArg)throw new Error(`a default value for a required argument is never used: '${e.name()}'`);return this.registeredArguments.push(e),this}helpCommand(e,t){if("boolean"==typeof e)return this._addImplicitHelpCommand=e,this;e=e??"help [command]";const[,i,n]=e.match(/([^ ]+) *(.*)/),r=t??"display help for command",s=this.createCommand(i);return s.helpOption(!1),n&&s.arguments(n),r&&s.description(r),this._addImplicitHelpCommand=!0,this._helpCommand=s,this}addHelpCommand(e,t){return"object"!=typeof e?(this.helpCommand(e,t),this):(this._addImplicitHelpCommand=!0,this._helpCommand=e,this)}_getHelpCommand(){return this._addImplicitHelpCommand??(this.commands.length&&!this._actionHandler&&!this._findCommand("help"))?(void 0===this._helpCommand&&this.helpCommand(void 0,void 0),this._helpCommand):null}hook(e,t){const i=["preSubcommand","preAction","postAction"];if(!i.includes(e))throw new Error(`Unexpected value for event passed to hook : '${e}'.\nExpecting one of '${i.join("', '")}'`);return this._lifeCycleHooks[e]?this._lifeCycleHooks[e].push(t):this._lifeCycleHooks[e]=[t],this}exitOverride(e){return this._exitCallback=e||(e=>{if("commander.executeSubCommandAsync"!==e.code)throw e}),this}_exit(e,t,i){this._exitCallback&&this._exitCallback(new R(e,t,i)),P.exit(e)}action(e){return this._actionHandler=t=>{const i=this.registeredArguments.length,n=t.slice(0,i);return this._storeOptionsAsProperties?n[i]=this:n[i]=this.opts(),n.push(this),e.apply(this,n)},this}createOption(e,t){return new I(e,t)}_callParseArg(e,t,i,n){try{return e.parseArg(t,i)}catch(e){if("commander.invalidArgument"===e.code){const t=`${n} ${e.message}`;this.error(t,{exitCode:e.exitCode,code:e.code})}throw e}}_registerOption(e){const t=e.short&&this._findOption(e.short)||e.long&&this._findOption(e.long);if(t){const i=e.long&&this._findOption(e.long)?e.long:e.short;throw new Error(`Cannot add option '${e.flags}'${this._name&&` to command '${this._name}'`} due to conflicting flag '${i}'\n-  already used by option '${t.flags}'`)}this.options.push(e)}_registerCommand(e){const t=e=>[e.name()].concat(e.aliases()),i=t(e).find((e=>this._findCommand(e)));if(i){const n=t(this._findCommand(i)).join("|"),r=t(e).join("|");throw new Error(`cannot add command '${r}' as already have command '${n}'`)}this.commands.push(e)}addOption(e){this._registerOption(e);const t=e.name(),i=e.attributeName();if(e.negate){const t=e.long.replace(/^--no-/,"--");this._findOption(t)||this.setOptionValueWithSource(i,void 0===e.defaultValue||e.defaultValue,"default")}else void 0!==e.defaultValue&&this.setOptionValueWithSource(i,e.defaultValue,"default");const n=(t,n,r)=>{null==t&&void 0!==e.presetArg&&(t=e.presetArg);const s=this.getOptionValue(i);null!==t&&e.parseArg?t=this._callParseArg(e,t,s,n):null!==t&&e.variadic&&(t=e._concatValue(t,s)),null==t&&(t=!e.negate&&(!(!e.isBoolean()&&!e.optional)||"")),this.setOptionValueWithSource(i,t,r)};return this.on("option:"+t,(t=>{const i=`error: option '${e.flags}' argument '${t}' is invalid.`;n(t,i,"cli")})),e.envVar&&this.on("optionEnv:"+t,(t=>{const i=`error: option '${e.flags}' value '${t}' from env '${e.envVar}' is invalid.`;n(t,i,"env")})),this}_optionEx(e,t,i,n,r){if("object"==typeof t&&t instanceof I)throw new Error("To add an Option object use addOption() instead of option() or requiredOption()");const s=this.createOption(t,i);if(s.makeOptionMandatory(!!e.mandatory),"function"==typeof n)s.default(r).argParser(n);else if(n instanceof RegExp){const e=n;n=(t,i)=>{const n=e.exec(t);return n?n[0]:i},s.default(r).argParser(n)}else s.default(n);return this.addOption(s)}option(e,t,i,n){return this._optionEx({},e,t,i,n)}requiredOption(e,t,i,n){return this._optionEx({mandatory:!0},e,t,i,n)}combineFlagAndOptionalValue(e=!0){return this._combineFlagAndOptionalValue=!!e,this}allowUnknownOption(e=!0){return this._allowUnknownOption=!!e,this}allowExcessArguments(e=!0){return this._allowExcessArguments=!!e,this}enablePositionalOptions(e=!0){return this._enablePositionalOptions=!!e,this}passThroughOptions(e=!0){return this._passThroughOptions=!!e,this._checkForBrokenPassThrough(),this}_checkForBrokenPassThrough(){if(this.parent&&this._passThroughOptions&&!this.parent._enablePositionalOptions)throw new Error(`passThroughOptions cannot be used for '${this._name}' without turning on enablePositionalOptions for parent command(s)`)}storeOptionsAsProperties(e=!0){if(this.options.length)throw new Error("call .storeOptionsAsProperties() before adding options");if(Object.keys(this._optionValues).length)throw new Error("call .storeOptionsAsProperties() before setting option values");return this._storeOptionsAsProperties=!!e,this}getOptionValue(e){return this._storeOptionsAsProperties?this[e]:this._optionValues[e]}setOptionValue(e,t){return this.setOptionValueWithSource(e,t,void 0)}setOptionValueWithSource(e,t,i){return this._storeOptionsAsProperties?this[e]=t:this._optionValues[e]=t,this._optionValueSources[e]=i,this}getOptionValueSource(e){return this._optionValueSources[e]}getOptionValueSourceWithGlobals(e){let t;return this._getCommandAndAncestors().forEach((i=>{void 0!==i.getOptionValueSource(e)&&(t=i.getOptionValueSource(e))})),t}_prepareUserArgs(e,t){if(void 0!==e&&!Array.isArray(e))throw new Error("first parameter to parse must be array or undefined");if(t=t||{},void 0===e&&void 0===t.from){P.versions?.electron&&(t.from="electron");const e=P.execArgv??[];(e.includes("-e")||e.includes("--eval")||e.includes("-p")||e.includes("--print"))&&(t.from="eval")}let i;switch(void 0===e&&(e=P.argv),this.rawArgs=e.slice(),t.from){case void 0:case"node":this._scriptPath=e[1],i=e.slice(2);break;case"electron":P.defaultApp?(this._scriptPath=e[1],i=e.slice(2)):i=e.slice(1);break;case"user":i=e.slice(0);break;case"eval":i=e.slice(1);break;default:throw new Error(`unexpected parse option { from: '${t.from}' }`)}return!this._name&&this._scriptPath&&this.nameFromFilename(this._scriptPath),this._name=this._name||"program",i}parse(e,t){const i=this._prepareUserArgs(e,t);return this._parseCommand([],i),this}async parseAsync(e,t){const i=this._prepareUserArgs(e,t);return await this._parseCommand([],i),this}_executeSubCommand(e,t){t=t.slice();let i=!1;const n=[".js",".ts",".tsx",".mjs",".cjs"];function r(e,t){const i=j.resolve(e,t);if(q.existsSync(i))return i;if(n.includes(j.extname(t)))return;const r=n.find((e=>q.existsSync(`${i}${e}`)));return r?`${i}${r}`:void 0}this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let s,o=e._executableFile||`${this._name}-${e._name}`,a=this._executableDir||"";if(this._scriptPath){let e;try{e=q.realpathSync(this._scriptPath)}catch(t){e=this._scriptPath}a=j.resolve(j.dirname(e),a)}if(a){let t=r(a,o);if(!t&&!e._executableFile&&this._scriptPath){const i=j.basename(this._scriptPath,j.extname(this._scriptPath));i!==this._name&&(t=r(a,`${i}-${e._name}`))}o=t||o}if(i=n.includes(j.extname(o)),"win32"!==P.platform?i?(t.unshift(o),t=W(P.execArgv).concat(t),s=T.spawn(P.argv[0],t,{stdio:"inherit"})):s=T.spawn(o,t,{stdio:"inherit"}):(t.unshift(o),t=W(P.execArgv).concat(t),s=T.spawn(P.execPath,t,{stdio:"inherit"})),!s.killed){["SIGUSR1","SIGUSR2","SIGTERM","SIGINT","SIGHUP"].forEach((e=>{P.on(e,(()=>{!1===s.killed&&null===s.exitCode&&s.kill(e)}))}))}const l=this._exitCallback;s.on("close",(e=>{e=e??1,l?l(new R(e,"commander.executeSubCommandAsync","(close)")):P.exit(e)})),s.on("error",(t=>{if("ENOENT"===t.code){const t=a?`searched for local subcommand relative to directory '${a}'`:"no directory for search for local subcommand, use .executableDir() to supply a custom directory",i=`'${o}' does not exist\n - if '${e._name}' is not meant to be an executable command, remove description parameter from '.command()' and use '.description()' instead\n - if the default executable name is not suitable, use the executableFile option to supply a custom name or path\n - ${t}`;throw new Error(i)}if("EACCES"===t.code)throw new Error(`'${o}' not executable`);if(l){const e=new R(1,"commander.executeSubCommandAsync","(error)");e.nestedError=t,l(e)}else P.exit(1)})),this.runningCommand=s}_dispatchSubcommand(e,t,i){const n=this._findCommand(e);let r;return n||this.help({error:!0}),r=this._chainOrCallSubCommandHook(r,n,"preSubcommand"),r=this._chainOrCall(r,(()=>{if(!n._executableHandler)return n._parseCommand(t,i);this._executeSubCommand(n,t.concat(i))})),r}_dispatchHelpCommand(e){e||this.help();const t=this._findCommand(e);return t&&!t._executableHandler&&t.help(),this._dispatchSubcommand(e,[],[this._getHelpOption()?.long??this._getHelpOption()?.short??"--help"])}_checkNumberOfArguments(){this.registeredArguments.forEach(((e,t)=>{e.required&&null==this.args[t]&&this.missingArgument(e.name())})),this.registeredArguments.length>0&&this.registeredArguments[this.registeredArguments.length-1].variadic||this.args.length>this.registeredArguments.length&&this._excessArguments(this.args)}_processArguments(){const e=(e,t,i)=>{let n=t;if(null!==t&&e.parseArg){const r=`error: command-argument value '${t}' is invalid for argument '${e.name()}'.`;n=this._callParseArg(e,t,i,r)}return n};this._checkNumberOfArguments();const t=[];this.registeredArguments.forEach(((i,n)=>{let r=i.defaultValue;i.variadic?n<this.args.length?(r=this.args.slice(n),i.parseArg&&(r=r.reduce(((t,n)=>e(i,n,t)),i.defaultValue))):void 0===r&&(r=[]):n<this.args.length&&(r=this.args[n],i.parseArg&&(r=e(i,r,i.defaultValue))),t[n]=r})),this.processedArgs=t}_chainOrCall(e,t){return e&&e.then&&"function"==typeof e.then?e.then((()=>t())):t()}_chainOrCallHooks(e,t){let i=e;const n=[];return this._getCommandAndAncestors().reverse().filter((e=>void 0!==e._lifeCycleHooks[t])).forEach((e=>{e._lifeCycleHooks[t].forEach((t=>{n.push({hookedCommand:e,callback:t})}))})),"postAction"===t&&n.reverse(),n.forEach((e=>{i=this._chainOrCall(i,(()=>e.callback(e.hookedCommand,this)))})),i}_chainOrCallSubCommandHook(e,t,i){let n=e;return void 0!==this._lifeCycleHooks[i]&&this._lifeCycleHooks[i].forEach((e=>{n=this._chainOrCall(n,(()=>e(this,t)))})),n}_parseCommand(e,t){const i=this.parseOptions(t);if(this._parseOptionsEnv(),this._parseOptionsImplied(),e=e.concat(i.operands),t=i.unknown,this.args=e.concat(t),e&&this._findCommand(e[0]))return this._dispatchSubcommand(e[0],e.slice(1),t);if(this._getHelpCommand()&&e[0]===this._getHelpCommand().name())return this._dispatchHelpCommand(e[1]);if(this._defaultCommandName)return this._outputHelpIfRequested(t),this._dispatchSubcommand(this._defaultCommandName,e,t);!this.commands.length||0!==this.args.length||this._actionHandler||this._defaultCommandName||this.help({error:!0}),this._outputHelpIfRequested(i.unknown),this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();const n=()=>{i.unknown.length>0&&this.unknownOption(i.unknown[0])},r=`command:${this.name()}`;if(this._actionHandler){let i;return n(),this._processArguments(),i=this._chainOrCallHooks(i,"preAction"),i=this._chainOrCall(i,(()=>this._actionHandler(this.processedArgs))),this.parent&&(i=this._chainOrCall(i,(()=>{this.parent.emit(r,e,t)}))),i=this._chainOrCallHooks(i,"postAction"),i}if(this.parent&&this.parent.listenerCount(r))n(),this._processArguments(),this.parent.emit(r,e,t);else if(e.length){if(this._findCommand("*"))return this._dispatchSubcommand("*",e,t);this.listenerCount("command:*")?this.emit("command:*",e,t):this.commands.length?this.unknownCommand():(n(),this._processArguments())}else this.commands.length?(n(),this.help({error:!0})):(n(),this._processArguments())}_findCommand(e){if(e)return this.commands.find((t=>t._name===e||t._aliases.includes(e)))}_findOption(e){return this.options.find((t=>t.is(e)))}_checkForMissingMandatoryOptions(){this._getCommandAndAncestors().forEach((e=>{e.options.forEach((t=>{t.mandatory&&void 0===e.getOptionValue(t.attributeName())&&e.missingMandatoryOptionValue(t)}))}))}_checkForConflictingLocalOptions(){const e=this.options.filter((e=>{const t=e.attributeName();return void 0!==this.getOptionValue(t)&&"default"!==this.getOptionValueSource(t)})),t=e.filter((e=>e.conflictsWith.length>0));t.forEach((t=>{const i=e.find((e=>t.conflictsWith.includes(e.attributeName())));i&&this._conflictingOption(t,i)}))}_checkForConflictingOptions(){this._getCommandAndAncestors().forEach((e=>{e._checkForConflictingLocalOptions()}))}parseOptions(e){const t=[],i=[];let n=t;const r=e.slice();function s(e){return e.length>1&&"-"===e[0]}let o=null;for(;r.length;){const e=r.shift();if("--"===e){n===i&&n.push(e),n.push(...r);break}if(!o||s(e)){if(o=null,s(e)){const t=this._findOption(e);if(t){if(t.required){const e=r.shift();void 0===e&&this.optionMissingArgument(t),this.emit(`option:${t.name()}`,e)}else if(t.optional){let e=null;r.length>0&&!s(r[0])&&(e=r.shift()),this.emit(`option:${t.name()}`,e)}else this.emit(`option:${t.name()}`);o=t.variadic?t:null;continue}}if(e.length>2&&"-"===e[0]&&"-"!==e[1]){const t=this._findOption(`-${e[1]}`);if(t){t.required||t.optional&&this._combineFlagAndOptionalValue?this.emit(`option:${t.name()}`,e.slice(2)):(this.emit(`option:${t.name()}`),r.unshift(`-${e.slice(2)}`));continue}}if(/^--[^=]+=/.test(e)){const t=e.indexOf("="),i=this._findOption(e.slice(0,t));if(i&&(i.required||i.optional)){this.emit(`option:${i.name()}`,e.slice(t+1));continue}}if(s(e)&&(n=i),(this._enablePositionalOptions||this._passThroughOptions)&&0===t.length&&0===i.length){if(this._findCommand(e)){t.push(e),r.length>0&&i.push(...r);break}if(this._getHelpCommand()&&e===this._getHelpCommand().name()){t.push(e),r.length>0&&t.push(...r);break}if(this._defaultCommandName){i.push(e),r.length>0&&i.push(...r);break}}if(this._passThroughOptions){n.push(e),r.length>0&&n.push(...r);break}n.push(e)}else this.emit(`option:${o.name()}`,e)}return{operands:t,unknown:i}}opts(){if(this._storeOptionsAsProperties){const e={},t=this.options.length;for(let i=0;i<t;i++){const t=this.options[i].attributeName();e[t]=t===this._versionOptionName?this._version:this[t]}return e}return this._optionValues}optsWithGlobals(){return this._getCommandAndAncestors().reduce(((e,t)=>Object.assign(e,t.opts())),{})}error(e,t){this._outputConfiguration.outputError(`${e}\n`,this._outputConfiguration.writeErr),"string"==typeof this._showHelpAfterError?this._outputConfiguration.writeErr(`${this._showHelpAfterError}\n`):this._showHelpAfterError&&(this._outputConfiguration.writeErr("\n"),this.outputHelp({error:!0}));const i=t||{},n=i.exitCode||1,r=i.code||"commander.error";this._exit(n,r,e)}_parseOptionsEnv(){this.options.forEach((e=>{if(e.envVar&&e.envVar in P.env){const t=e.attributeName();(void 0===this.getOptionValue(t)||["default","config","env"].includes(this.getOptionValueSource(t)))&&(e.required||e.optional?this.emit(`optionEnv:${e.name()}`,P.env[e.envVar]):this.emit(`optionEnv:${e.name()}`))}}))}_parseOptionsImplied(){const e=new L(this.options),t=e=>void 0!==this.getOptionValue(e)&&!["default","implied"].includes(this.getOptionValueSource(e));this.options.filter((i=>void 0!==i.implied&&t(i.attributeName())&&e.valueFromOption(this.getOptionValue(i.attributeName()),i))).forEach((e=>{Object.keys(e.implied).filter((e=>!t(e))).forEach((t=>{this.setOptionValueWithSource(t,e.implied[t],"implied")}))}))}missingArgument(e){const t=`error: missing required argument '${e}'`;this.error(t,{code:"commander.missingArgument"})}optionMissingArgument(e){const t=`error: option '${e.flags}' argument missing`;this.error(t,{code:"commander.optionMissingArgument"})}missingMandatoryOptionValue(e){const t=`error: required option '${e.flags}' not specified`;this.error(t,{code:"commander.missingMandatoryOptionValue"})}_conflictingOption(e,t){const i=e=>{const t=e.attributeName(),i=this.getOptionValue(t),n=this.options.find((e=>e.negate&&t===e.attributeName())),r=this.options.find((e=>!e.negate&&t===e.attributeName()));return n&&(void 0===n.presetArg&&!1===i||void 0!==n.presetArg&&i===n.presetArg)?n:r||e},n=e=>{const t=i(e),n=t.attributeName();return"env"===this.getOptionValueSource(n)?`environment variable '${t.envVar}'`:`option '${t.flags}'`},r=`error: ${n(e)} cannot be used with ${n(t)}`;this.error(r,{code:"commander.conflictingOption"})}unknownOption(e){if(this._allowUnknownOption)return;let t="";if(e.startsWith("--")&&this._showSuggestionAfterError){let i=[],n=this;do{const e=n.createHelp().visibleOptions(n).filter((e=>e.long)).map((e=>e.long));i=i.concat(e),n=n.parent}while(n&&!n._enablePositionalOptions);t=z(e,i)}const i=`error: unknown option '${e}'${t}`;this.error(i,{code:"commander.unknownOption"})}_excessArguments(e){if(this._allowExcessArguments)return;const t=this.registeredArguments.length,i=1===t?"":"s",n=`error: too many arguments${this.parent?` for '${this.name()}'`:""}. Expected ${t} argument${i} but got ${e.length}.`;this.error(n,{code:"commander.excessArguments"})}unknownCommand(){const e=this.args[0];let t="";if(this._showSuggestionAfterError){const i=[];this.createHelp().visibleCommands(this).forEach((e=>{i.push(e.name()),e.alias()&&i.push(e.alias())})),t=z(e,i)}const i=`error: unknown command '${e}'${t}`;this.error(i,{code:"commander.unknownCommand"})}version(e,t,i){if(void 0===e)return this._version;this._version=e,t=t||"-V, --version",i=i||"output the version number";const n=this.createOption(t,i);return this._versionOptionName=n.attributeName(),this._registerOption(n),this.on("option:"+n.name(),(()=>{this._outputConfiguration.writeOut(`${e}\n`),this._exit(0,"commander.version",e)})),this}description(e,t){return void 0===e&&void 0===t?this._description:(this._description=e,t&&(this._argsDescription=t),this)}summary(e){return void 0===e?this._summary:(this._summary=e,this)}alias(e){if(void 0===e)return this._aliases[0];let t=this;if(0!==this.commands.length&&this.commands[this.commands.length-1]._executableHandler&&(t=this.commands[this.commands.length-1]),e===t._name)throw new Error("Command alias can't be the same as its name");const i=this.parent?._findCommand(e);if(i){const t=[i.name()].concat(i.aliases()).join("|");throw new Error(`cannot add alias '${e}' to command '${this.name()}' as already have command '${t}'`)}return t._aliases.push(e),this}aliases(e){return void 0===e?this._aliases:(e.forEach((e=>this.alias(e))),this)}usage(e){if(void 0===e){if(this._usage)return this._usage;const e=this.registeredArguments.map((e=>D(e)));return[].concat(this.options.length||null!==this._helpOption?"[options]":[],this.commands.length?"[command]":[],this.registeredArguments.length?e:[]).join(" ")}return this._usage=e,this}name(e){return void 0===e?this._name:(this._name=e,this)}nameFromFilename(e){return this._name=j.basename(e,j.extname(e)),this}executableDir(e){return void 0===e?this._executableDir:(this._executableDir=e,this)}helpInformation(e){const t=this.createHelp();return void 0===t.helpWidth&&(t.helpWidth=e&&e.error?this._outputConfiguration.getErrHelpWidth():this._outputConfiguration.getOutHelpWidth()),t.formatHelp(this,t)}_getHelpContext(e){const t={error:!!(e=e||{}).error};let i;return i=t.error?e=>this._outputConfiguration.writeErr(e):e=>this._outputConfiguration.writeOut(e),t.write=e.write||i,t.command=this,t}outputHelp(e){let t;"function"==typeof e&&(t=e,e=void 0);const i=this._getHelpContext(e);this._getCommandAndAncestors().reverse().forEach((e=>e.emit("beforeAllHelp",i))),this.emit("beforeHelp",i);let n=this.helpInformation(i);if(t&&(n=t(n),"string"!=typeof n&&!Buffer.isBuffer(n)))throw new Error("outputHelp callback must return a string or a Buffer");i.write(n),this._getHelpOption()?.long&&this.emit(this._getHelpOption().long),this.emit("afterHelp",i),this._getCommandAndAncestors().forEach((e=>e.emit("afterAllHelp",i)))}helpOption(e,t){return"boolean"==typeof e?(this._helpOption=e?this._helpOption??void 0:null,this):(e=e??"-h, --help",t=t??"display help for command",this._helpOption=this.createOption(e,t),this)}_getHelpOption(){return void 0===this._helpOption&&this.helpOption(void 0,void 0),this._helpOption}addHelpOption(e){return this._helpOption=e,this}help(e){this.outputHelp(e);let t=P.exitCode||0;0===t&&e&&"function"!=typeof e&&e.error&&(t=1),this._exit(t,"commander.help","(outputHelp)")}addHelpText(e,t){const i=["beforeAll","before","after","afterAll"];if(!i.includes(e))throw new Error(`Unexpected value for position to addHelpText.\nExpecting one of '${i.join("', '")}'`);const n=`${e}Help`;return this.on(n,(e=>{let i;i="function"==typeof t?t({error:e.error,command:e.command}):t,i&&e.write(`${i}\n`)})),this}_outputHelpIfRequested(e){const t=this._getHelpOption();t&&e.find((e=>t.is(e)))&&(this.outputHelp(),this._exit(0,"commander.helpDisplayed","(outputHelp)"))}}function W(e){return e.map((e=>{if(!e.startsWith("--inspect"))return e;let t,i,n="127.0.0.1",r="9229";return null!==(i=e.match(/^(--inspect(-brk)?)$/))?t=i[1]:null!==(i=e.match(/^(--inspect(-brk|-port)?)=([^:]+)$/))?(t=i[1],/^\d+$/.test(i[3])?r=i[3]:n=i[3]):null!==(i=e.match(/^(--inspect(-brk|-port)?)=([^:]+):(\d+)$/))&&(t=i[1],n=i[3],r=i[4]),t&&"0"!==r?`${t}=${n}:${parseInt(r)+1}`:e}))}x.Command=M;const{Argument:B}=O,{Command:U}=x,{CommanderError:G,InvalidArgumentError:Y}=A,{Help:K}=C,{Option:Q}=$;b.program=new U,b.createCommand=e=>new U(e),b.createOption=(e,t)=>new Q(e,t),b.createArgument=(e,t)=>new B(e,t),b.Command=U,b.Option=Q,b.Argument=B,b.Help=K,b.CommanderError=G,b.InvalidArgumentError=Y,b.InvalidOptionArgumentError=Y;const{program:J,createCommand:X,createArgument:Z,createOption:ee,CommanderError:te,InvalidArgumentError:ie,InvalidOptionArgumentError:ne,Command:re,Argument:se,Option:oe,Help:ae}=b;var le=[[/(?:(?<!po)int(?!(?:eger|erval))4?(?![28])|integer|serial4?(?![28]))/,"int"],[/(?:smallint|int2|serial2|smallserial)/,"smallint"],[/(?:bigint|int8|serial8|bigserial)/,"bigint"],[/(?:varbit|bit(?: varying)?)(\(\d+\))?/,"bit$1"],[/bool(?:ean)?/,"tinyint(1) unsigned"],[/(?:real|float4)/,"float"],[/(?:double precision|float8)/,"double"],[/(?:numeric|decimal)(\(\d+(,\d+)?\))?/,"decimal$1"],[/money/,"decimal(19,2)"],[/(?:national )?(?:char(?!acter)|character(?! varying))(\(\d+\))?/,"char$1"],[/(?:national )?(?:varchar|character varying)(\(\d+\))?/,"varchar$1"],[/(?:interval|(?<!with(?:out)? )time(?!stamp)(?:tz)?)(\(\d+\))?(?: with(?:out)? time zone)?/,"time$1"],[/timestamp(?:tz)?(?:\(\d+\))?(?: with(?:out)? time zone)?/,"datetime"],[/bytea/,"longblob"],[/text/,"text"],[/(?:cidr|inet)/,"varchar(43)"],[/macaddr/,"varchar(17)"],[/uuid/,"varchar(36)"],[/(?:xml|jsonb?|tsvector|tsquery|array|point|txid_snapshot)/,"longtext"],[/(?:line|lseg|path)/,"linestring"],[/(?:box|polygon|circle)/,"polygon"]];let ce;var he=e=>{if(!ce){const e=[];for(let[t]of le)e.push(`(?:${t.source})`);for(let t of["regclass"])e.push(`(?:${t})`);ce=new RegExp(`::(?:${e.join("|")})`,"ig")}return e.replace(ce,"")},ue=e=>e.replace(/(CREATE INDEX ..*?) (ON ..*?) (USING btree)/,"$1 $3 $2"),pe=e=>{const t=e.match(/ALTER TABLE[^;]*FOREIGN KEY[^;]*;/gi);if(!t)return e;let i,n;for(let r of t){if(n=r.match(/ALTER TABLE(?: ONLY)? (?:public\.)?([a-z_][a-z_0-9]+)\s+ADD CONSTRAINT (?:..*) FOREIGN KEY \(([a-z_][a-z_0-9]+)\) REFERENCES (?:public\.)?([a-z_][a-z_0-9]+)\(([a-z_][a-z_0-9]+)\);/i),!n)continue;const[t,s,o,a]=n.slice(1);if(i=new RegExp(`CREATE TABLE (?:public.)?${o} \\([\\s\\S]*?\\s${a} (..*?)[\\s,][^;]*;`,"i"),n=e.match(i),!n)continue;const[l]=n.slice(1);if(i=new RegExp(`CREATE TABLE (?:public.)?${t} \\([\\s\\S]*?\\s(${s} ..*?)[\\s,][^;]*?;`,"i"),n=e.match(i),!n)continue;const[c,h]=n;e=e.replace(c,c.replace(h,`${s} ${l}`))}return e},me=["a","abort","abs","absent","absolute","access","according","acos","action","ada","add","admin","after","aggregate","all","allocate","also","alter","always","analyse","analyze","and","any","any_value","are","array","array_agg","array_​max_​cardinality","as","asc","asensitive","asin","assertion","assignment","asymmetric","at","atan","atomic","attach","attribute","attributes","authorization","avg","backward","base64","before","begin","begin_frame","begin_partition","bernoulli","between","bigint","binary","bit","bit_length","blob","blocked","bom","boolean","both","breadth","btrim","by","c","cache","call","called","cardinality","cascade","cascaded","case","cast","catalog","catalog_name","ceil","ceiling","chain","chaining","char","character","characteristics","characters","character_length","character_​set_​catalog","character_set_name","character_set_schema","char_length","check","checkpoint","class","classifier","class_origin","clob","close","cluster","coalesce","cobol","collate","collation","collation_catalog","collation_name","collation_schema","collect","column","columns","column_name","command_function","command_​function_​code","comment","comments","commit","committed","compression","concurrently","condition","conditional","condition_number","configuration","conflict","connect","connection","connection_name","constraint","constraints","constraint_catalog","constraint_name","constraint_schema","constructor","contains","content","continue","control","conversion","convert","copartition","copy","corr","corresponding","cos","cosh","cost","count","covar_pop","covar_samp","create","cross","csv","cube","cume_dist","current","current_catalog","current_date","current_​default_​transform_​group","current_path","current_role","current_row","current_schema","current_time","current_timestamp","current_​transform_​group_​for_​type","current_user","cursor","cursor_name","cycle","data","database","datalink","date","datetime_​interval_​code","datetime_​interval_​precision","day","db","deallocate","dec","decfloat","decimal","declare","default","defaults","deferrable","deferred","define","defined","definer","degree","delete","delimiter","delimiters","dense_rank","depends","depth","deref","derived","desc","describe","descriptor","detach","deterministic","diagnostics","dictionary","disable","discard","disconnect","dispatch","distinct","dlnewcopy","dlpreviouscopy","dlurlcomplete","dlurlcompleteonly","dlurlcompletewrite","dlurlpath","dlurlpathonly","dlurlpathwrite","dlurlscheme","dlurlserver","dlvalue","do","document","domain","double","drop","dynamic","dynamic_function","dynamic_​function_​code","each","element","else","empty","enable","encoding","encrypted","end","end-exec","end_frame","end_partition","enforced","enum","equals","error","escape","event","every","except","exception","exclude","excluding","exclusive","exec","execute","exists","exp","explain","expression","extension","external","extract","false","family","fetch","file","filter","final","finalize","finish","first","first_value","flag","float","floor","following","for","force","foreign","format","fortran","forward","found","frame_row","free","freeze","from","fs","fulfill","full","function","functions","fusion","g","general","generated","get","global","go","goto","grant","granted","greatest","group","grouping","groups","handler","having","header","hex","hierarchy","hold","hour","id","identity","if","ignore","ilike","immediate","immediately","immutable","implementation","implicit","import","in","include","including","increment","indent","index","indexes","indicator","inherit","inherits","initial","initially","inline","inner","inout","input","insensitive","insert","instance","instantiable","instead","int","integer","integrity","intersect","intersection","interval","into","invoker","is","isnull","isolation","join","json","json_array","json_arrayagg","json_exists","json_object","json_objectagg","json_query","json_scalar","json_serialize","json_table","json_table_primitive","json_value","k","keep","key","keys","key_member","key_type","label","lag","language","large","last","last_value","lateral","lead","leading","leakproof","least","left","length","level","library","like","like_regex","limit","link","listagg","listen","ln","load","local","localtime","localtimestamp","location","locator","lock","locked","log","log10","logged","lower","lpad","ltrim","m","map","mapping","match","matched","matches","match_number","match_recognize","materialized","max","maxvalue","measures","member","merge","message_length","message_octet_length","message_text","method","min","minute","minvalue","mod","mode","modifies","module","month","more","move","multiset","mumps","name","names","namespace","national","natural","nchar","nclob","nested","nesting","new","next","nfc","nfd","nfkc","nfkd","nil","no","none","normalize","normalized","not","nothing","notify","notnull","nowait","nth_value","ntile","null","nullable","nullif","nulls","null_ordering","number","numeric","object","occurrence","occurrences_regex","octets","octet_length","of","off","offset","oids","old","omit","on","one","only","open","operator","option","options","or","order","ordering","ordinality","others","out","outer","output","over","overflow","overlaps","overlay","overriding","owned","owner","p","pad","parallel","parameter","parameter_mode","parameter_name","parameter_​ordinal_​position","parameter_​specific_​catalog","parameter_​specific_​name","parameter_​specific_​schema","parser","partial","partition","pascal","pass","passing","passthrough","password","past","path","pattern","per","percent","percentile_cont","percentile_disc","percent_rank","period","permission","permute","pipe","placing","plan","plans","pli","policy","portion","position","position_regex","power","precedes","preceding","precision","prepare","prepared","preserve","prev","primary","prior","private","privileges","procedural","procedure","procedures","program","prune","ptf","public","publication","quote","quotes","range","rank","read","reads","real","reassign","recheck","recovery","recursive","ref","references","referencing","refresh","regr_avgx","regr_avgy","regr_count","regr_intercept","regr_r2","regr_slope","regr_sxx","regr_sxy","regr_syy","reindex","relative","release","rename","repeatable","replace","replica","requiring","reset","respect","restart","restore","restrict","result","return","returned_cardinality","returned_length","returned_​octet_​length","returned_sqlstate","returning","returns","revoke","right","role","rollback","rollup","routine","routines","routine_catalog","routine_name","routine_schema","row","rows","row_count","row_number","rpad","rtrim","rule","running","savepoint","scalar","scale","schema","schemas","schema_name","scope","scope_catalog","scope_name","scope_schema","scroll","search","second","section","security","seek","select","selective","self","semantics","sensitive","sequence","sequences","serializable","server","server_name","session","session_user","set","setof","sets","share","show","similar","simple","sin","sinh","size","skip","smallint","snapshot","some","sort_direction","source","space","specific","specifictype","specific_name","sql","sqlcode","sqlerror","sqlexception","sqlstate","sqlwarning","sqrt","stable","standalone","start","state","statement","static","statistics","stddev_pop","stddev_samp","stdin","stdout","storage","stored","strict","string","strip","structure","style","subclass_origin","submultiset","subscription","subset","substring","substring_regex","succeeds","sum","support","symmetric","sysid","system","system_time","system_user","t","table","tables","tablesample","tablespace","table_name","tan","tanh","temp","template","temporary","text","then","through","ties","time","timestamp","timezone_hour","timezone_minute","to","token","top_level_count","trailing","transaction","transactions_​committed","transactions_​rolled_​back","transaction_active","transform","transforms","translate","translate_regex","translation","treat","trigger","trigger_catalog","trigger_name","trigger_schema","trim","trim_array","true","truncate","trusted","type","types","uescape","unbounded","uncommitted","unconditional","under","unencrypted","union","unique","unknown","unlink","unlisten","unlogged","unmatched","unnamed","unnest","until","untyped","update","upper","uri","usage","user","user_​defined_​type_​catalog","user_​defined_​type_​code","user_​defined_​type_​name","user_​defined_​type_​schema","using","utf16","utf32","utf8","vacuum","valid","validate","validator","value","values","value_of","varbinary","varchar","variadic","varying","var_pop","var_samp","verbose","version","versioning","view","views","volatile","when","whenever","where","whitespace","width_bucket","window","with","within","without","work","wrapper","write","xml","xmlagg","xmlattributes","xmlbinary","xmlcast","xmlcomment","xmlconcat","xmldeclaration","xmldocument","xmlelement","xmlexists","xmlforest","xmliterate","xmlnamespaces","xmlparse","xmlpi","xmlquery","xmlroot","xmlschema","xmlserialize","xmltable","xmltext","xmlvalidate","year","yes","zone"];let de;var ge=e=>(de||(de=new RegExp(`"(${me.join("|")})"`,"ig")),e.replace(de,(e=>e.replace(/"/g,"`")))),fe=e=>{let t;if(t=e.match(/([a-z_][a-z_0-9]+) text DEFAULT md5\(\((?:to_)?hex\(nextval\('(?:public\.)?([a-z_][a-z_0-9]+)'(?:\::..*)?\)\)\s+\|\|\s+'(..*)'(?:\::text)?\)\)/i)){const[i,n,r,s]=t;return e.replace(i,`${n} varchar(32) DEFAULT md5((concat(hex(nextval(${r})), '${s}')))`)}if(t=e.match(/([a-z_][a-z_0-9]+) (..*) DEFAULT nextval\('(?:public\.)?(..*)'(?:\::..*)?\)/i)){const[i,n,r,s]=t;return e.replace(i,`${n} ${r} DEFAULT nextval(${s})`)}return e};let _e;var ve=e=>{const t=e.match(/ALTER TABLE[^;]*PRIMARY KEY[^;]*;/gi);if(!t)return e;for(let i of t){if(_e=i.match(/ALTER TABLE(?: ONLY)? (?:public\.)?([a-z_][a-z_0-9]+)\s+ADD CONSTRAINT (?:..*) PRIMARY KEY \(([a-z_][a-z_0-9]+)\)[^;]*;/i),!_e)continue;const[t,n,r]=_e,s=new RegExp(`CREATE TABLE (?:public.)?${n} \\([\\s\\S]*?\\s(${r} text)[\\s,][^;]*;`,"i");if(_e=e.match(s),!_e)continue;const[o,a]=_e;e=e.replace(o,o.replace(a,`${r} varchar(768)`))}return e},be=e=>{const t=le.find((([t])=>{const i=e.match(new RegExp(`(?<= )${t.source}`,"i"));return i&&i[0]}));if(!t)return e;const[i,n]=t;return e.replace(new RegExp(`(?<= )${i.source}`,"i"),n)},Oe=Object.freeze({__proto__:null,removePostgreSQLCastOperator:he,replaceCreateIndexPostgreSQL2MariaDB:ue,replaceForeignKeySourceColumnType:pe,replaceReservedWordEnclosurePostgreSQL2MariaDB:ge,replaceSequencePostgreSQL2MariaDB:fe,replaceTextTypePrimaryKeyWithVarchar768:ve,replaceTypePostgreSQL2MariaDB:be,reservedKeywords:me,typeMapping:le});exports.cli=async()=>{try{const e=J.requiredOption("-i, --in <filepath>","Input file path (PostgreSQL dump).").requiredOption("-o, --out <filepath>","Output file path (MariaDB dump).").option("-d, --debug","Debug mode. Default is false.").parse(process.argv).opts(),t=u.default.join(__dirname,`../${e.in}`),i=u.default.join(__dirname,`../${e.out}`);if(!h.default.existsSync(t))throw new Error(`Input file not found (${t})`);const n=h.default.createReadStream(t),r=h.default.createWriteStream(i),s=m.default.createInterface({input:n,output:r,terminal:!1});let o=0;for await(let t of s)++o,e.debug&&console.log(`${o}: ${t}`),t.trim()?/^SET/.test(t)||/^SELECT pg_catalog\.set/.test(t)||(t=t.replace(/public\./,""),t=he(t),t=be(t),t=t.replace(/to_hex/,"hex"),t=t.replace(/ALTER TABLE ONLY/,"ALTER TABLE"),t=fe(t),t=ue(t),t=ge(t),r.write(`${t}${p.default.EOL}`)):r.write(`${t}${p.default.EOL}`);r.end();let a=h.default.readFileSync(i,{encoding:"utf8"});a=ve(a),a=pe(a),h.default.writeFileSync(i,a,{encoding:"utf8"}),console.log("END")}catch(e){console.error(`ERROR: ${e.message||"Unknown error"}`)}},exports.core=Oe;
